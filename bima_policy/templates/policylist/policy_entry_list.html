{%extends "base.html"%}
{%block content%}
{% load static %}

<main class="app-main">
   <!-- .app-main -->
   <div class="wrapper">
      <!-- .wrapper -->
      <div class="page ">
         <!-- .page -->
         <div class="page-inner">
            <!-- .page-inner -->
            <header class="page-title-bar">
               <!-- .page-title-bar -->
               <!-- grid row -->
               <div class="row text-center text-sm-left">
                  <!-- grid column -->
                  <div class="col">
                     <h1 class="page-title"> Policy List
                        <button type="button" class="btn btn-secondary btn-sm float-right" data-toggle="modal" hidden
                           data-target="#mdlcolsetting" title="Column Setting"><i class="fa fa-cog"
                              aria-hidden="true"></i> Column Setting</button>
                     </h1>
                  </div>
                  <!-- /grid column -->
               </div>
               <!-- /grid row -->
            </header>
            <!-- .page-section -->
            <div class="page-section">
               <!-- .card -->
               <div class="card card-fluid">
                  <!-- .card-header -->
                  <div class="card-header">
                     <form id="frminslist" autocomplete="off">
                        <div class="row">
                           <div class="col-md-2 col-sm-12">
                              <select class="custom-select" name="period" id="select-period">
                                 <option value="today">Today</option>
                                 <option value="yesterday">Yesterday</option>
                                 <option value="this_month">This Month</option>
                                 <option value="last_month">Last Month</option>
                                 <option value="current_year">Current Year</option>
                                 <option value="custom">Custom</option>
                              </select>
                           </div>

                           <div class="col-md-2 col-sm-12">
                              <div class="form-group">
                                 <input type="text" id="frmDate" data-alt-format="Y-m-d" data-date-format="d/m/Y"
                                    data-toggle="flatpickr" placeholder="DD-MM-YYYY"
                                    class="form-control flatpickr-input" disabled="" readonly="readonly">
                              </div>
                           </div>
                           <div class="col-md-2 col-sm-12">
                              <div class="form-group">
                                 <input type="text" id="toDate" data-alt-format="Y-m-d" data-date-format="d/m/Y"
                                    data-toggle="flatpickr" placeholder="DD-MM-YYYY"
                                    class="form-control datepicker flatpickr-input" disabled="" readonly="readonly">
                              </div>
                           </div>

                           <div class="col-md-3 col-sm-12" hidden>
                              <select name="agents" data-parsley-required-message=""
                                 class="custom-select select2 select2-hidden-accessible" id="agents"
                                 data-parsley-required="true" tabindex="-1" aria-hidden="true">
                                 <option value=""> All Agents</option>
                                 <!-- {%for value in datag%}
                                 <option value={{value.full_name}}>{{value.full_name}}</option>
                                 {%endfor%} -->
                              </select>
                           </div>

                           <div class="col-md-6 ">
                              <div class="form-group">
                                 <button onclick="entry_filter()" type="button" id="filterlist"
                                    class="btn btn-secondary " title="Filter"><i class="fa fa-search"
                                       aria-hidden="true"></i> </button>
                                 <button type="button" id="btnreset" class="btn btn-secondary" title="Refresh"
                                    onclick="resertDocument()"><i class="icofont icofont-refresh"
                                       aria-hidden="true"></i> </button>
                                 <button type="button" onclick="ExportToExcel('xlsx')" id="download_inslist"
                                    class="btn btn-secondary " title="Download"><i class="fa fa-download"
                                       aria-hidden="true"></i> </button>
                                 <button data-toggle="modal" data-target="" type="button" id="bulk_remove"
                                    class="btn btn-secondary" title="Delete"><i class="icofont icofont-trash"
                                       aria-hidden="true"></i> </button>
                                 <a id="linkShowFilterDiv" href="#" class="no-wrap pl-0 morefilter" title="More Filter"
                                    onclick="showMoreFilters()"><small>More
                                       Filter</small></a>


                                 <div class="modal fade" id="mdlcolsetting"
                                    onmouseenter="document.getElementById('inp_search').focus()" style="height: 400px">

                                    <div class="modal-dialog" role="document">

                                       <div class="modal-content">
                                          <div class="modal-header">
                                             <h5 id="rtoModalLabel" class="modal-title"> Delete Policy</h5>
                                          </div>
                                          <div class="modal-body ">
                                             <div class="form-row">
                                                <div class="col-md-12 mb-4">
                                                   <div class=""><label>Are You Sure? You want to delete the
                                                         Record(s)..<input hidden id="inp_search" type="text" value=""
                                                            class="form-control" name="agent"
                                                            style="text-transform: uppercase;"
                                                            title="Search POS using Name, mobile no, email, pan/aadhar number">
                                                      </label></div>
                                                </div>

                                             </div>

                                             <div class="modal-footer">
                                                <button id="btnExit" type="button" class="btn btn-secondary w-100p"
                                                   data-dismiss="modal">Cancel</button>

                                                <button type="button" id="posUpdate" onclick="bulk_policy_remove()"
                                                   class="btn btn-primary w-100p "
                                                   style="background: red;">Delete</button>

                                             </div>
                                          </div>

                                       </div>

                                    </div>
                                    <!-- <body onload="setFocus()">
                                                
                                             </body> -->

                                 </div>
                              </div>
                           </div>
                           <div class="col-md-2 ">

                              <!-- <input id="payout_switch" type="checkbox" value="No Payouts">
                              <label for="">No Payouts</label> -->

                           </div>
                           {% if is_user %}
                           <div class="col-md-1" style="text-align: right;" hidden>
                              <style>
                                 .switch {
                                    position: relative;
                                    display: inline-block;
                                    width: 60px;
                                    height: 34px;
                                 }

                                 .switch input {
                                    opacity: 0;
                                    width: 0;
                                    height: 0;
                                 }

                                 .slider {
                                    position: absolute;
                                    cursor: pointer;
                                    top: 0;
                                    left: 0;
                                    right: 0;
                                    bottom: 0;
                                    background-color: #ccc;
                                    -webkit-transition: .4s;
                                    transition: .4s;
                                 }

                                 .slider:before {
                                    position: absolute;
                                    content: "";
                                    height: 26px;
                                    width: 26px;
                                    left: 4px;
                                    bottom: 4px;
                                    background-color: white;
                                    -webkit-transition: .4s;
                                    transition: .4s;
                                 }

                                 input:checked+.slider {
                                    background-color: #2196F3;
                                 }

                                 input:focus+.slider {
                                    box-shadow: 0 0 1px #2196F3;
                                 }

                                 input:checked+.slider:before {
                                    -webkit-transform: translateX(26px);
                                    -ms-transform: translateX(26px);
                                    transform: translateX(26px);
                                 }

                                 /* Rounded sliders */
                                 .slider.round {
                                    border-radius: 34px;
                                 }

                                 .slider.round:before {
                                    border-radius: 50%;
                                 }
                              </style>

                              <label class="switch">
                                 <input id="payout_switch" type="checkbox">
                                 <span class="slider round"></span>
                              </label>
                           </div>
                           {% endif %}
                        </div>
                        <div id="morefilters" class="row" hidden>
                           <div class="form-row">
                              <input id="ps1" name="ps1" type="checkbox" value="No Payouts" class="checkbox mr-2"
                                 style="margin-bottom: auto; margin-top: 4px;">
                              <label for="ps1">Payout-less Policies</label>
                           </div>

                           <div class="col-md-5 mb-4">

                              <input type="text" id="search-select_vc" class="form-control"
                                 placeholder="Select any field">
                              <select id="filter_type" name="filter_type" data-parsley-required-message="" multiple
                                 data-parsley-required="true" class="custom-select " required
                                 onchange="add_filter_type()">
                                 <option value="pos">POSPS</option>
                                 <option value="insurance_company">Insurers</option>
                                 <option value="vehicle_catagory">Vehicle Catagory</option>
                                 <option value="vehicle_makeby">Vehicle Makeby</option>
                                 <option value="vehicle_model">Vehicle Model</option>
                                 <option value="vehicle_fuel_type">Fuel Type</option>
                                 <option value="cubic_capacity">Cubic Capacity</option>
                                 <option value="seating_capacity">Seating Capacity</option>
                                 <option value="coverage_type">Coverage Type</option>
                                 <option value="gvw">GVW</option>
                                 <option value="policy_type">Policy Type</option>
                                 <option value="addon">Addon</option>
                                 <option value="ncb">NCB</option>
                                 <option value="cpa">CPA</option>

                              </select>
                              <!-- <input type="text" id="search-select_vc" class="form-control"> -->

                              <button id="select-all_vc" hidden>Select All</button>
                              <button id="deselect-all_vc" hidden>Deselect All</button>

                              <script>
                                 const select_vc = document.getElementById("vehicle_catagory");
                                 const selectAllButton_vc = document.getElementById("select-all_vc");
                                 const deselectAllButton_vc = document.getElementById("deselect-all_vc");
                                 const searchInput_vc = document.getElementById("search-select_vc");

                                 selectAllButton_vc.addEventListener("click", () => {
                                    Array.from(select.options).forEach(option => option.selected = true);
                                 });

                                 deselectAllButton_vc.addEventListener("click", () => {
                                    Array.from(select.options).forEach(option => option.selected = false);
                                 });

                                 searchInput_vc.addEventListener("input", () => {
                                    const searchValue = searchInput_vc.value.toLowerCase();
                                    Array.from(select_vc.options).forEach(option => {
                                       const optionText = option.textContent.toLowerCase();
                                       option.style.display = optionText.includes(searchValue) ? "" : "none";
                                    });
                                 });

                              </script>

                              <script>

                                 function add_filter_type() {

                                    filter_type_value = document.getElementById('filter_type').value
                                    filter_content = document.getElementById('filter_content')

                                    fuel_col = ['PETROL', 'DIESEL', 'CNG', 'ELECTRIC']
                                    cc_col = ['75CC-150CC', '150CC-350CC', 'ABOVE 350CC', 'BELOW 1000CC', '1000CC-1500CC', 'ABOVE 1500CC']
                                    ct_col = ['1 YEAR PACKAGE', '1+2 YEAR PACKAGE', '1+4 YEAR PACKAGE', '3 YEAR TP', '5 YEAR TP', 'TP ONLY', 'OD ONLY']
                                    sc_col = ['BELOW 5', '5-7', '7-12', '12-18', 'ABOVE 18']
                                    gvw_col = ['BELOW 2000', '2000-2500', '2500-3500', '3500-7000', '7000-7500', '7500-12000', '12000-25000', '25000-40000', 'ABOVE 40000']
                                    policy_type_col = ['FRESH', 'RENEWAL', 'ROLLOVER', 'ENDORSEMENT']
                                    addon_col = ['YES', 'NO']
                                    ncb_col = ['YES', 'NO']
                                    cpa_col = ['YES', 'NO']

                                    if (filter_type_value == 'pos') {
                                       addAgentNames();
                                    }
                                    else if (filter_type_value == 'insurance_company') {
                                       addInsurerNames();
                                    }
                                    else if (filter_type_value == 'vehicle_catagory') {
                                       // add_items(vcat_col, filter_content)                                     

                                       addVehicleCat()
                                    }
                                    else if (filter_type_value == 'vehicle_makeby') {
                                       // add_items(vmb_col, filter_content)
                                       addVehicleMakes();
                                    }
                                    else if (filter_type_value == 'vehicle_model') {
                                       // add_items(vmb_col, filter_content)
                                       addVehicleModels();
                                    }
                                    else if (filter_type_value == 'vehicle_fuel_type') {
                                       add_items(fuel_col, filter_content)
                                    }
                                    else if (filter_type_value == 'cubic_capacity') {
                                       add_items(cc_col, filter_content)
                                    }
                                    else if (filter_type_value == 'coverage_type') {
                                       add_items(ct_col, filter_content)
                                    }
                                    else if (filter_type_value == 'seating_capacity') {
                                       add_items(sc_col, filter_content)
                                    }
                                    else if (filter_type_value == 'gvw') {
                                       add_items(gvw_col, filter_content)
                                    }
                                    else if (filter_type_value == 'policy_type') {
                                       add_items(policy_type_col, filter_content)
                                    }
                                    else if (filter_type_value == 'addon') {
                                       add_items(addon_col, filter_content)
                                    }
                                    else if (filter_type_value == 'ncb') {
                                       add_items(ncb_col, filter_content)
                                    }
                                    else if (filter_type_value == 'cpa') {
                                       add_items(cpa_col, filter_content)
                                    }
                                 }
                              </script>

                           </div>


                           <div id="divFilterContent" class="col-md-5 mb-4">
                              <!-- <label for="my-select">Vehicle Make:</label> -->
                              <input type="text" id="search-select" class="form-control" placeholder="Search..">
                              <select id="filter_content" name="filter_content" class="form-control" multiple
                                 onclick="filterFetchList()">
                                 <option id="op_select_all" value="" onclick="select_all_Items('filter_content')">
                                 </option>

                              </select>
                              <!-- <input type="text" id="search-select" class="form-control"> -->

                              <button id="select-all" hidden>Select All</button>
                              <button id="deselect-all" hidden>Deselect All</button>

                              <script>
                                 const select = document.getElementById("filter_content");
                                 const selectAllButton = document.getElementById("select-all");
                                 const deselectAllButton = document.getElementById("deselect-all");
                                 const searchInput = document.getElementById("search-select");

                                 selectAllButton.addEventListener("click", () => {
                                    Array.from(select.options).forEach(option => option.selected = true);
                                 });

                                 deselectAllButton.addEventListener("click", () => {
                                    Array.from(select.options).forEach(option => option.selected = false);
                                 });

                                 searchInput.addEventListener("input", () => {
                                    const searchValue = searchInput.value.toLowerCase();
                                    Array.from(select.options).forEach(option => {
                                       const optionText = option.textContent.toLowerCase();
                                       option.style.display = optionText.includes(searchValue) ? "" : "none";
                                    });
                                 });

                              </script>
                              <script>

                                 function add_select_all_option() {

                                    filter_content = document.getElementById('filter_content')
                                    filter_content.innerHTML = ''

                                    var newoption = document.createElement("option");
                                    newoption.value = ''
                                    newoption.innerHTML = '--select all--'

                                    // newoption.onclick = function() { alert('Hello'); };
                                    newoption.onclick = function () {
                                       for (i = 1; i <= filter_content.options.length - 1; i++) {
                                          filter_content.options[i].selected = true
                                       }
                                       filter_content.options[filter_content.options.length - filter_content.options.length].selected = false

                                    };

                                    filter_content.options.add(newoption);
                                 }

                                 function add_items(data, element) {

                                    add_select_all_option()

                                    data.forEach(item => {
                                       var newoption = document.createElement("option");
                                       newoption.value = item
                                       newoption.innerHTML = item
                                       element.options.add(newoption);
                                    });

                                    // select_all_Items(element.id)
                                 }

                                 function select_all_Items(name) {

                                    var item = document.getElementById(name)

                                    try {
                                       if (item.value == '') {
                                          for (i = 1; i <= item.length - 1; i++) {
                                             item.options[i].selected = true
                                          }
                                       }
                                    } catch (error) {

                                    }

                                    item.options[item.options.length - item.options.length].selected = false
                                 }

                              </script>
                           </div>

                           <div id="divFilterContentBtns" class="col-md-1 mb-4">

                              <button type="button" class="btn btn-primary" onclick="addName2()" hidden>Add</button>
                              <!-- <button id="btnFilter" type="button" class="btn btn-primary mt-1"
                                 onclick="searchName2()">Filter</button> -->
                              <button type="button" class="btn btn-primary mt-1 w-100"
                                 onclick="addToFilterList()">FREEZE</button>

                              {% if is_user %}

                              <button id="btnUpdatePayout" type="button" class="btn btn-primary mt-1 " enabled hidden
                                 data-toggle="modal" data-target="#mdlUpdatePayout">Update</button>

                              {% else %}
                              <button id="btnUpdatePayout" type="button" class="btn btn-primary mt-1  w-100" disabled
                                 data-toggle="modal" data-target="#mdlUpdatePayout">Update</button>
                              {% endif %}

                              <button id="btnSaveFilter" type="button" class="btn btn-primary mt-1" hidden
                                 onclick="saveFilter()">Save</button>
                              <button type="button" class="btn btn-primary mt-1  w-100" onmouseenter="getLength()"
                                 onclick="clearFilterList()">CLEAR</button>

                           </div>

                        </div>
                     </form>
                  </div>
                  <!-- /.card-header -->
                  <!-- .card-body -->
                  <div class="card-body">

                     <div class="">
                        <div id="tblInsurance_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer no-scroll">
                           <div class="form-row  mb-3">
                              <div class="col-md-6">
                                 <div class="dataTables_length" id="tblInsurance_length">
                                    <label>
                                       Show
                                       <select id="select_length" name="tblInsurance_length"
                                          onchange="showNextRows(true)" aria-controls="tblInsurance"
                                          class="custom-select">
                                          <option value="3">3</option>
                                          <option value="5" selected>5</option>
                                          <option value="10">10</option>
                                          <option value="25">25</option>
                                          <option value="50">50</option>
                                          <option value="100">100</option>
                                          <option value="0">all</option>
                                       </select>
                                       entries
                                    </label>
                                 </div>


                              </div>

                              <div class="col-md-6">
                                 <div id="tblInsurance_filter" class="dataTables_filter"><label>Search:<input value=""
                                          type="search" id="myInput" oninput="searchName()"
                                          onkeypress="searchPol(event)" class="form-control" placeholder=""
                                          aria-controls="tblInsurance"></label></div>
                              </div>

                           </div>
                        </div>
                     </div>

                     <div class="table-responsive">
                        <div class="dataTables_scroll">
                           <div class="dataTables_scrollHead" style="position: relative; border: 0px; width: 100%;">
                              <div class="dataTables_scrollHeadInner"
                                 style="box-sizing: content-box; width: auto; padding-right: 0px;">
                                 <table
                                    class="table table-striped1 table-hover no-wrap table-bordered no-footer dataTable"
                                    aria-describedby="tblInsurance_info" role="grid"
                                    style="margin-left: 0px; width: 5774.97px;">

                                 </table>
                              </div>
                           </div>
                           <div class="dataTables_scrollBody" style="position: relative;  width: 100%;">
                              <table id="tblInsurance"
                                 class="table table-striped1 table-hover no-wrap table-bordered no-footer dataTable"
                                 aria-describedby="tblInsurance_info" role="grid">

                                 <thead style="border-bottom: inset;">
                                    <tr role="row">
                                       <th class=" text-center sorting thShow" tabindex="0" aria-controls="tblInsurance"
                                          rowspan="1" colspan="1" style="width: 83.2344px;"
                                          aria-label="Sr.No.: activate to sort column ascending">Sr.No.</th>
                                       <!-- <th id="thCheck" class="text-center sorting_disabled sorting" tabindex="0"
                                          aria-controls="tblInsurance" rowspan="1" colspan="1" style="width: 30px;"
                                          aria-label="">
                                          <input type="checkbox" class="checkbox" id="chkblkrm"
                                             onchange="selectAllPolicy()" />
                                       </th> -->

                                       <!-- <th class="sorting">PolicyID</th> -->
                                       <th class="sorting thShow">Proposal No.</th>
                                       <th class="sorting text-center">Policy No. </th>
                                       <th class="sorting thShow">Customer Name</th>
                                       <th class="sorting  thShow">Insurer Name</th>
                                       <th class="sorting">Service Provider</th>
                                       <th class="sorting">Broker Code</th>
                                       <th class="sorting">Product Name</th>
                                       <th class="sorting">Registration No.</th>
                                       <th class="sorting">RTO State</th>
                                       <th class="sorting">RTO City</th>
                                       <th class="sorting">Vehicle Makeby </th>
                                       <th class="sorting">Vehicle Model </th>
                                       <th class="sorting thShow">Vehicle Catagory </th>
                                       <th class="sorting">Vehicle Fuel Type</th>
                                       <th class="sorting">Manufacture Year </th>
                                       <th class="sorting">Addon</th>
                                       <th class="sorting">NCB</th>
                                       <th class="sorting">Cubic Capacity</th>
                                       <th class="sorting">GVW</th>
                                       <th class="sorting">Seating Capacity</th>
                                       <th class="sorting">Coverage Type</th>
                                       <th class="sorting">Policy Type</th>
                                       <th class="sorting">CPA</th>
                                       <th class="sorting">Risk Start Date</th>
                                       <th class="sorting">Risk End Date</th>
                                       <th class="sorting">Issue Date</th>
                                       <th class="sorting">Insured Age</th>
                                       <th class="sorting">Policy Term</th>
                                       <th class="sorting">BQP</th>
                                       <th class="sorting">POS</th>
                                       <th class="sorting">Employee</th>
                                       <th class="sorting">Remark</th>
                                       <th class="sorting thShow">OD Premium</th>
                                       <th class="sorting thShow">TP / Terrorism</th>
                                       <th class="sorting thShow">NET Premium</th>
                                       <th class="sorting thShow">GST 18%</th>
                                       <th class="sorting thShow">GST 12%</th>
                                       <th class="sorting thShow">Total</th>
                                       <th class="sorting">Payment Mode</th>

                                       <th class="sorting thShow">Agent OD Reward %</th>
                                       <th class="sorting thShow">Agent OD Amount</th>
                                       <th class="sorting thShow">Agent TP Reward %</th>
                                       <th class="sorting thShow">Agent TP Amount</th>
                                       {% if is_user %}
                                       <th class="sorting thShow">Self OD Reward %</th>
                                       <th class="sorting thShow">Self OD Amount</th>
                                       <th class="sorting thShow">Self TP Reward %</th>
                                       <th class="sorting thShow">Self TP Amount</th>
                                       {% endif %}
                                       <th class="sorting">Proposal</th>
                                       <th class="sorting">Mandate</th>
                                       <th class="sorting">Policy</th>
                                       <th class="sorting">Previous Policy</th>
                                       <th class="sorting">Pan Card</th>
                                       <th class="sorting">Aadhar Card</th>
                                       <th class="sorting">Vehicle RC</th>
                                       <th class="sorting">Inspection Report</th>
                                       <th class="sorting">Action</th>
                                    </tr>
                                 </thead>

                                 <tbody id="tbdy">

                                    <!-- {% for value in data %}                              -->
                                    <tr role="row" class="policy-row odd" onclick="highlight(this)" id="tr1">

                                       <td class="text-center">{{forloop.counter}}</td>
                                       <!-- <td class="text-center"><input type="checkbox" value="2479" class="checkbox"
                                             id="chkblkrm{{forloop.counter}}" /></td> -->

                                       <!-- <td>{{value.policyid}}</td> -->
                                       <td>{{value.proposal_no}}</td>
                                       <td>
                                          <a href="" class="tile tile-img" target="_blank"><i
                                                class="far fa-file-pdf text-danger mt-1"></i></a>
                                          <a href="/bima_policy/policy/policy_entrydata/{{value.policyid}}"
                                             class="">{{value.policy_no}}</a>
                                       </td>
                                       <td>{{value.customer_name}}</td>
                                       <td>{{value.insurance_company}}</td>
                                       <td>{{value.sp_name}}</td>
                                       <td>{{value.sp_brokercode}}</td>
                                       <td>{{value.product_name}}</td>
                                       <td>{{value.registration_no}}</td>
                                       <td>{{value.rto_state}}</td>
                                       <td>{{value.rto_city}}</td>
                                       <td>{{value.vehicle_makeby}}</td>
                                       <td>{{value.vehicle_model}}</td>
                                       <td>{{value.vehicle_catagory}}</td>
                                       <td>{{value.vehicle_fuel_type}}</td>

                                       {% if value.mfg_year%}
                                       <td>{{value.mfg_year}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       <td>{{value.addon}}</td>
                                       <td>{{value.ncb}}</td>
                                       <td>{{value.cubic_capacity}}</td>
                                       <td>{{value.gvw}}</td>

                                       <!-- Note: Space added because Excel converts 5-7 or 7-12 as date formate -->
                                       <td>&nbsp;{{value.seating_capacity}}</td>

                                       <td>{{value.coverage_type}}</td>
                                       <td>{{value.policy_type}}</td>
                                       <td>{{value.cpa}}</td>
                                       <td>{{value.risk_start_date}}</td>
                                       <td>{{value.risk_end_date}}</td>
                                       <td>{{value.issue_date}}</td>

                                       {% if value.insured_age%}
                                       <td>{{value.insured_age}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       <td>{{value.policy_term}}</td>
                                       <td>{{value.bqp}}</td>
                                       <td>{{value.pos}}</td>
                                       <td>{{value.employee}}</td>
                                       <td>{{value.remark}}</td>
                                       <!-- OD  -->

                                       <td>{{value.OD_premium}}</td>

                                       <td>{{value.TP_terrorism}}</td>
                                       <td>{{value.net}}</td>

                                       <td>{{value.gst_amount}}</td>

                                       {% if value.gst_gcv_amount %}
                                       <td>{{ value.gst_gcv_amount }}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       <td>{{value.total}}</td>

                                       <td>{{value.payment_mode}}</td>

                                       {% if value.agent_od_reward%}
                                       <td>{{value.agent_od_reward}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.agent_od_amount%}
                                       <td>{{value.agent_od_amount}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.agent_tp_reward%}
                                       <td>{{value.agent_tp_reward}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.agent_tp_amount%}
                                       <td>{{value.agent_tp_amount}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if is_user %}

                                       {% if value.self_od_reward%}
                                       <td>{{value.self_od_reward}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.self_od_amount%}
                                       <td>{{value.self_od_amount}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.self_tp_reward%}
                                       <td>{{value.self_tp_reward}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% if value.self_tp_amount%}
                                       <td>{{value.self_tp_amount}}</td>
                                       {% else %}
                                       <td></td>
                                       {% endif %}

                                       {% endif %}

                                       <td> <a href="#" class="text-black"
                                             onclick="downloadFile('{{value.proposal}}')">{{value.proposal}}</a> </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.mandate}}')">{{value.mandate}}</a> </td>
                                       <td> <a href="#" onclick="downloadFile('{{value.policy}}')">{{value.policy}}</a>
                                       </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.previous_policy}}')">{{value.previous_policy}}</a>
                                       </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.pan_card}}')">{{value.pan_card}}</a> </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.aadhar_card}}')">{{value.aadhar_card}}</a>
                                       </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.vehicle_rc}}')">{{value.vehicle_rc}}</a>
                                       </td>
                                       <td> <a href="#"
                                             onclick="downloadFile('{{value.inspection_report}}')">{{value.inspection_report}}</a>
                                       </td>

                                       <!-- <td> <a href="/media/{{value.proposal}}">{{value.proposal}}</a> </td> -->
                                       <!-- <td> <a href="/media/{{value.mandate}}">{{value.mandate}}</a> </td> -->
                                       <!-- <td> <a href="/media/{{value.policy}}">{{value.policy}}</a> </td>
                                       <td> <a href="/media/{{value.previous_policy}}">{{value.previous_policy}}</a>
                                       </td>
                                       <td> <a href="/media/{{value.pan_card}}">{{value.pan_card}}</a> </td>
                                       <td> <a href="/media/{{value.aadhar_card}}">{{value.aadhar_card}}</a> </td>
                                       <td> <a href="/media/{{value.vehicle_rc}}">{{value.vehicle_rc}}</a> </td>
                                       <td> <a href="/media/{{value.inspection_report}}">{{value.inspection_report}}</a>  </td> -->

                                       <td class="text-center">
                                          <form method="POST">
                                             {% csrf_token %}
                                             <a href="/bima_policy/policy/policy_entrydata/{{value.policyid}}"
                                                class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary" name="Edit">
                                                <i class="fa fa-pencil-alt mt-2"></i>
                                                <!-- href="/bima_policy/policy/policy_entrydata/{{value.policyid}}" -->
                                             </a>
                                             <a href="/bima_policy/deleted_policy/{{value.policyid}}" name="Remove"
                                                class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary text-danger">
                                                <i class="far fa-trash-alt mt-2"></i>

                                                <!-- href="/bima_policy/policy/{{value.policyid}}/delete" -->

                                             </a>
                                       </td>
                                    </tr>
                                    <!-- {% endfor %} -->

                                 </tbody>

                              </table>


                           </div>
                        </div>
                     </div>

                     <button id="nextButton" class="btn btn-secondary mt-3" onclick="showNextRows(false)" hidden
                        style="float: right; color: #FFFFFF; background: #6E11F4; ">Next</button>

                     <button id="pevButton" class="btn btn-secondary mt-3" hidden
                        style="float: right; color: #FFFFFF; background: #6E11F4; ">Back</button>

                     <div class="col-sm-12 col-md-7 d-flex justify-content-end"
                        style="align-content: right; margin-left: auto; margin-right: 0;">
                        <div class="dataTables_paginate paging_simple_numbers" id="tblList_paginate" hidden>
                           <ul class="pagination justify-content-center ">
                              {% if data.has_previous %}
                              <li id="link_one" class="paginate_button page-item active "><a href="?page=1"
                                    aria-controls="tblList" data-dt-idx="1" tabindex="0" class="page-link">First</a>
                              </li>
                              <li id="link_two" class="paginate_button page-item active"><a
                                    href="?page={{ data.previous_page_number }}" aria-controls="tblList" data-dt-idx="1"
                                    tabindex="0" class="page-link"> &laquo; Prev</a></li>
                              {% endif %}

                              <!-- <li class="paginate_button page-item active"><a href="#" aria-controls="tblList"
                                    data-dt-idx="1" tabindex="0" class="page-link"> Page {{ data.number }} of
                                    {{data.paginator.num_pages }}.</a></li> -->

                              <li class="paginate_button page-item active"><a href="#" aria-controls="tblList"
                                    data-dt-idx="1" tabindex="0" class="page-link">
                                 </a></li>

                              {% if data.has_next %}

                              <li class="paginate_button page-item active "><a href="?page={{ data.next_page_number }}"
                                    aria-controls="tblList" data-dt-idx="1" tabindex="0" class="page-link"> Next
                                    &raquo;</a></li>

                              <li class="paginate_button page-item active "><a
                                    href="?page={{ data.paginator.num_pages }}" aria-controls="tblList" data-dt-idx="1"
                                    tabindex="0" class="page-link"> Last &raquo;</a></li>

                              {% endif %}

                              <li hidden id="link_gen" class="paginate_button page-item active "><a href="#"
                                    aria-controls="tblList" data-dt-idx="1" tabindex="0" class="page-link"
                                    onclick="gen_table()">Next Page
                                 </a></li>

                           </ul>

                        </div>
                     </div>

                     <!-- /.page-section -->
                     <div class="modal fade" id="mdlrpolicy" data-backdrop="static" data-keyboard="false" tabindex="-1"
                        role="dialog" aria-labelledby="mdTitle1" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                           <div class="modal-content">
                              <div class="modal-header">
                                 <h5 id="mdTitle1" class="modal-title">Confirmation</h5>
                              </div>
                              <div class="modal-body">
                                 <p><i class="fa fa-question-circle text-red mr-1"></i> Do you want to permanently
                                    delete selected Insurance?</p>
                              </div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary w-100p" data-dismiss="modal">No</button>
                                 <button type="submit" id="remove" class="btn btn-primary w-100p">Yes</button>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="modal fade" id="mdlcpolicy" data-backdrop="static" data-keyboard="false" tabindex="-1"
                        role="dialog" aria-labelledby="mdTitle2" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                           <div class="modal-content">
                              <div class="modal-header">
                                 <h5 id="mdTitle2" class="modal-title">Cancel Policy</h5>
                              </div>
                              <form id="frmcancelp" data-parsley-validate="true" novalidate="">
                                 <div class="modal-body">
                                    <label>Cancel Remarks<abbr title="Required" class="text-danger">*</abbr></label>
                                    <textarea class="form-control" data-parsley-required="true"
                                       id="txtcancel_remakrs"></textarea>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary w-100p"
                                       data-dismiss="modal">No</button>
                                    <button type="submit" id="cancel" class="btn btn-danger w-100p">Cancel</button>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                     <div class="modal fade" id="mdlcolsetting" data-backdrop="static" data-keyboard="false"
                        tabindex="-1" role="dialog" aria-labelledby="rtoModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                           <div class="modal-content">
                              <div class="modal-header">
                                 <h5 id="rtoModalLabel" class="modal-title"> Column Setting </h5>
                              </div>
                              <div class="modal-body modal-scroll">
                                 <ul class="disabled pl-0 mb-0">
                                    <li class="list-group-item disabled  bg-light">
                                       <i class="fa fa-ban drag-indicator-block"></i>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" checked="">
                                          <label class="custom-control-label"><small class="text">1)</small> Policy
                                             No.</label>
                                       </div>
                                    </li>
                                 </ul>
                                 <ul class="sortable-lists list-group list-group-flush list-group-bordered"
                                    data-toggle="sortable" data-group="pages">
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="2" value="1" checked="">
                                          <label class="custom-control-label" for="2"><small class="text">2)</small>
                                             REGISTRATION</label>
                                       </div>
                                       <input type="hidden" class="colval" value="REGISTRATION">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="3" value="1" checked="">
                                          <label class="custom-control-label" for="3"><small class="text">3)</small>
                                             ISSUE_DATE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="ISSUE_DATE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="4" value="1" checked="">
                                          <label class="custom-control-label" for="4"><small class="text">4)</small>
                                             RISK_DATE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="RISK_DATE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="5" value="1" checked="">
                                          <label class="custom-control-label" for="5"><small class="text">5)</small>
                                             POLICY_M</label>
                                       </div>
                                       <input type="hidden" class="colval" value="POLICY_MADE_BY">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="6" value="1" checked="">
                                          <label class="custom-control-label" for="6"><small class="text">6)</small>
                                             CANCEL_REMARKS</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CANCEL_REMARKS">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="7" value="1" checked="">
                                          <label class="custom-control-label" for="7"><small class="text">7)</small>
                                             CUSTOMER</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CUSTOMER">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="8" value="1" checked="">
                                          <label class="custom-control-label" for="8"><small class="text">8)</small>
                                             VEHICLE_CATEGORY</label>
                                       </div>
                                       <input type="hidden" class="colval" value="VEHICLE_CATEGORY">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="9" value="1" checked="">
                                          <label class="custom-control-label" for="9"><small class="text">9)</small>
                                             POLICY_PROVIDER</label>
                                       </div>
                                       <input type="hidden" class="colval" value="POLICY_PROVIDER">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="10" value="1" checked="">
                                          <label class="custom-control-label" for="10"><small class="text">10)</small>
                                             POLICY_PROVIDER_CODE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="POLICY_PROVIDER_CODE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="11" value="1" checked="">
                                          <label class="custom-control-label" for="11"><small class="text">11)</small>
                                             INSURANCE_COMPANY</label>
                                       </div>
                                       <input type="hidden" class="colval" value="INSURANCE_COMPANY">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="12" value="0">
                                          <label class="custom-control-label" for="12"><small class="text">12)</small>
                                             RTO</label>
                                       </div>
                                       <input type="hidden" class="colval" value="RTO">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="13" value="1" checked="">
                                          <label class="custom-control-label" for="13"><small class="text">13)</small>
                                             POLICY_TYPE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="POLICY_TYPE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="14" value="1" checked="">
                                          <label class="custom-control-label" for="14"><small class="text">14)</small>
                                             MANUFACTURE_YEAR</label>
                                       </div>
                                       <input type="hidden" class="colval" value="MANUFACTURE_YEAR">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="15" value="1" checked="">
                                          <label class="custom-control-label" for="15"><small class="text">15)</small>
                                             FUEL_TYPE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="FUEL_TYPE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="16" value="1" checked="">
                                          <label class="custom-control-label" for="16"><small class="text">16)</small>
                                             VEHICLE_OTHER_INFO</label>
                                       </div>
                                       <input type="hidden" class="colval" value="VEHICLE_OTHER_INFO">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="17" value="1" checked="">
                                          <label class="custom-control-label" for="17"><small class="text">17)</small>
                                             OD</label>
                                       </div>
                                       <input type="hidden" class="colval" value="OD">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="18" value="1" checked="">
                                          <label class="custom-control-label" for="18"><small class="text">18)</small>
                                             TP</label>
                                       </div>
                                       <input type="hidden" class="colval" value="TP">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="19" value="1" checked="">
                                          <label class="custom-control-label" for="19"><small class="text">19)</small>
                                             NET</label>
                                       </div>
                                       <input type="hidden" class="colval" value="NET">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="20" value="1" checked="">
                                          <label class="custom-control-label" for="20"><small class="text">20)</small>
                                             GST</label>
                                       </div>
                                       <input type="hidden" class="colval" value="GST">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="21" value="1" checked="">
                                          <label class="custom-control-label" for="21"><small class="text">21)</small>
                                             TOTAL_NET</label>
                                       </div>
                                       <input type="hidden" class="colval" value="TOTAL_NET">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="22" value="1" checked="">
                                          <label class="custom-control-label" for="22"><small class="text">22)</small>
                                             COMM</label>
                                       </div>
                                       <input type="hidden" class="colval" value="COMM">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="23" value="1" checked="">
                                          <label class="custom-control-label" for="23"><small class="text">23)</small>
                                             AGENT</label>
                                       </div>
                                       <input type="hidden" class="colval" value="AGENT">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="24" value="1" checked="">
                                          <label class="custom-control-label" for="24"><small class="text">24)</small>
                                             REMARKS</label>
                                       </div>
                                       <input type="hidden" class="colval" value="REMARKS">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="25" value="1" checked="">
                                          <label class="custom-control-label" for="25"><small class="text">25)</small>
                                             SELF_COMM.</label>
                                       </div>
                                       <input type="hidden" class="colval" value="SELF_COMM.">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="26" value="1" checked="">
                                          <label class="custom-control-label" for="26"><small class="text">26)</small>
                                             CREATED_ON</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CREATED_ON">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="27" value="1" checked="">
                                          <label class="custom-control-label" for="27"><small class="text">27)</small>
                                             CANCEL_ON</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CANCEL_ON">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="28" value="1" checked="">
                                          <label class="custom-control-label" for="28"><small class="text">28)</small>
                                             PREVIOUS_POLICY</label>
                                       </div>
                                       <input type="hidden" class="colval" value="PREVIOUS_POLICY">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="29" value="1" checked="">
                                          <label class="custom-control-label" for="29"><small class="text">29)</small>
                                             VEHICLE_RC</label>
                                       </div>
                                       <input type="hidden" class="colval" value="VEHICLE_RC">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="30" value="1" checked="">
                                          <label class="custom-control-label" for="30"><small class="text">30)</small>
                                             CASE_TYPE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CASE_TYPE">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="31" value="1" checked="">
                                          <label class="custom-control-label" for="31"><small class="text">31)</small>
                                             CHASIS_NO</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CHASIS_NO">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="32" value="1" checked="">
                                          <label class="custom-control-label" for="32"><small class="text">32)</small>
                                             ENGINE_NO</label>
                                       </div>
                                       <input type="hidden" class="colval" value="ENGINE_NO">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="33" value="1" checked="">
                                          <label class="custom-control-label" for="33"><small class="text">33)</small>
                                             VEHICLE_MAKEBY</label>
                                       </div>
                                       <input type="hidden" class="colval" value="VEHICLE_MAKEBY">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="34" value="1" checked="">
                                          <label class="custom-control-label" for="34"><small class="text">34)</small>
                                             VEHICLE_MODEL</label>
                                       </div>
                                       <input type="hidden" class="colval" value="VEHICLE_MODEL">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="35" value="1" checked="">
                                          <label class="custom-control-label" for="35"><small class="text">35)</small>
                                             CPA</label>
                                       </div>
                                       <input type="hidden" class="colval" value="CPA">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="36" value="1" checked="">
                                          <label class="custom-control-label" for="36"><small class="text">36)</small>
                                             AGENT CALC.</label>
                                       </div>
                                       <input type="hidden" class="colval" value="AGENT CALC.">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="37" value="1" checked="">
                                          <label class="custom-control-label" for="37"><small class="text">37)</small>
                                             SELF_CALC.</label>
                                       </div>
                                       <input type="hidden" class="colval" value="SELF_CALC.">
                                    </li>
                                    <li class="list-group-item align-items-center drag-handle">
                                       <span class="drag-indicator"></span>
                                       <div class="custom-control custom-checkbox">
                                          <input type="checkbox" class="custom-control-input" data-sort="checkbox"
                                             id="38" value="1" checked="">
                                          <label class="custom-control-label" for="38"><small class="text">38)</small>
                                             PAYMENT_MODE</label>
                                       </div>
                                       <input type="hidden" class="colval" value="PAYMENT_MODE">
                                    </li>
                                 </ul>
                              </div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary w-100p"
                                    data-dismiss="modal">Close</button>
                                 <button type="button" id="md-ilc-colUpdate"
                                    class="btn btn-primary w-100p">Save</button>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="modal fade" id="confirm-modal-remove" data-backdrop="static" data-keyboard="false"
                        tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                           <div class="modal-content">
                              <div class="modal-header">
                                 <h5 id="rtoModalLabel" class="modal-title"> Confirmation </h5>
                              </div>
                              <div class="modal-body">
                                 <div id="resbulkremove" class="d-none alert alert-danger">
                                    select atleast one action for remove
                                 </div>
                                 <p>You can also delete some part of the policy form, for that you have to select the
                                    part from the table given below.</p>
                                 <table class="table table-bordered">
                                    <tbody>
                                       <tr class="bg-light">
                                          <th colspan="2">Select</th>
                                       </tr>
                                       <tr>
                                          <td>Complete Policy Form</td>
                                          <td class="text-center"><input class="checkbox" type="checkbox"
                                                id="chkpolicy_form"></td>
                                       </tr>
                                       <tr>
                                          <td>Previous Policy PDF</td>
                                          <td class="text-center"><input class="checkbox" type="checkbox"
                                                data-remove-group="block-r" id="chkprevious_documents"></td>
                                       </tr>
                                       <tr>
                                          <td>Vehicle RC</td>
                                          <td class="text-center"><input class="checkbox" type="checkbox"
                                                data-remove-group="block-r" id="chkvehicle_rc"></td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <button id="load-more-btn">Load More</button>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary w-100p"
                                    data-dismiss="modal">Close</button>
                                 <button type="button" id="mdlbtnblkremove"
                                    class="btn bg-red text-white w-100p">Remove</button>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- /.page-inner -->
               </div>
               <!-- /.page -->
            </div>
            <!-- /.wrapper -->

</main>
<!-- /.app-main -->
<div class="aside-backdrop"></div>
</div><!-- /.app -->
<div class="modal modal-alert fade" id="ModalAlertError" data-backdrop="static" tabindex="-1" role="dialog"
   aria-labelledby="ModalAlertErrorLabel" aria-hidden="true">
   <!-- .modal-dialog -->
   <div class="modal-dialog" role="document">
      <!-- .modal-content -->
      <div class="modal-content">
         <!-- .modal-header -->
         <div class="modal-header">
            <h5 class="modal-title">
               <i class="fa fa-exclamation-triangle text-red mr-1"></i> System Error
            </h5>
         </div>
         <!-- /.modal-header -->
         <!-- .modal-body -->
         <div class="modal-body">
            <p>The Code Execution cannot proceed due to system error, retry after refreshing the page if the error
               remains the same, you need to contact your Administrator immediately.</p>
         </div>
         <!-- /.modal-body -->
         <!-- .modal-footer -->
         <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">OK</button>
         </div>
         <!-- /.modal-footer -->
      </div>
      <!-- /.modal-content -->
   </div>
   <!-- /.modal-dialog -->
</div>

<div class="modal fade" id="mdlUpdatePayout" style="height: 400px">

   <div class="modal-dialog" role="document">

      <div class="modal-content">
         <div class="modal-header">
            <h5 id="rtoModalLabel" class="modal-title"> Payout </h5>
         </div>
         <div class="modal-body ">
            <div class="form-row">
               <div class="col-md-6 mb-2">

                  <div class=""><label>Agent OD Reward:
                        <input type="text" value="" id="a_od_reward" name="a_od_reward"
                           class="form-control maskNumField col-lg-7 rewardpct" data-mask-as-number-decimals="2"
                           data-parsley-required="true" min="0" max="100" maxlength="4">

                        <script>
                           function handle(e) {
                              if (e.keyCode === 13) {
                                 e.preventDefault(); // Ensure it is only this code that runs

                                 $("#btnExit").click();
                              }
                           }
                        </script>
                     </label></div>
               </div>
               <div class="col-md-6 mb-2 ">
                  <div class=""><label>Agent TP Reward:
                        <input type="text" value="" id="a_tp_reward" name="a_tp_reward"
                           class="form-control maskNumField col-lg-7 rewardpct" data-mask-as-number-decimals="2"
                           data-parsley-required="true" min="0" max="100" maxlength="4">
                     </label>
                  </div>
               </div>

               <!-- self payout -->
               <div class="col-md-6 mb-2">
                  <div class=""><label>Self OD Reward:
                        <input type="text" value="" name="s_od_reward" id="s_od_reward"
                           class="form-control maskNumField col-lg-7 rewardpct" data-mask-as-number-decimals="2"
                           data-parsley-required="true" min="0" max="100" maxlength="4">

                        <script>
                           function handle(e) {
                              if (e.keyCode === 13) {
                                 e.preventDefault(); // Ensure it is only this code that runs

                                 $("#btnExit").click();
                              }
                           }
                        </script>
                     </label></div>
               </div>

               <div class="col-md-6 mb-2">
                  <div class=""><label>Self TP Reward:
                        <input type="text" value="" id="s_tp_reward" name="s_tp_reward"
                           class="form-control maskNumField col-lg-7 rewardpct " data-mask-as-number-decimals="2"
                           data-parsley-required="true" min="0" max="100" maxlength="4">
                     </label>
                  </div>
               </div>

            </div>

            <div class="modal-footer">
               <div class="form-row" style="align-content: center;"></div>
               <button class="btn btn-primary w-100p" onclick="applyPayouts()">Apply</button>
               <button id="btnExit" type="button" class="btn btn-secondary w-100p" data-dismiss="modal">Close</button>

            </div>
         </div>

      </div>

   </div>


</div>

<!-- <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script> -->
<!-- it was moved to base.html -->

<script>
   var c = [];
   var fetchList = []
   var filterList = []
   var freezList = []
   var filteredList = []

   var filterListMultiple = []
   var isMultiFilter = false
   var isNone = false
   var NoneList = []
   var rowList = []
   var policyid_list = []
   var payoutValues = []
   var filter_date_list = []
   var initialResponse = []
   var curIndex = 0
   var returned_index = 0
   var tableRows = '';

   function load_values() {
      // pids = "{{policyid_list|safe}}".replace('[', '').replace(']', '').split(',')
      // console.log('res ' + pids);

      // pids.forEach(element => {
      //    console.log(element.replace("'", "").replace("'", "").trim())
      //    policyid_list.push(element.replace("'", "").replace("'", "").trim())
      // });

      // policies = "{{ policies | safe }}"

      // console.log(policies);

      // document.getElementById('showMoreButton2').click()

   }

   function selectAllPolicy() {

      var tblInsurance = document.getElementById('tblInsurance')
      var rowLength = tblInsurance.rows.length;
      chkblkrm_isChecked = document.getElementById('chkblkrm').checked
      tr = tblInsurance.getElementsByTagName("tr");

      ids = ''

      if (chkblkrm_isChecked) {
         for (i = 1; i < rowLength; i++) {
            id = `chkblkrm${i}`
            document.getElementById(id).checked = true
            highlight(tr[i])
         }
      }
      else {
         for (i = 1; i < rowLength; i++) {
            id = `chkblkrm${i}`
            document.getElementById(id).checked = false
            highlight(tr[i])
         }
      }
   }

   function bulk_policy_remove() {
      alert('control here')
      return;
      var tblInsurance = document.getElementById('tblInsurance')
      var rowLength = tblInsurance.rows.length;
      ids = ''

      for (i = 1; i < rowLength; i++) {

         id = `chkblkrm${i}`

         isChecked = document.getElementById(id).checked

         if (isChecked) {

            ids += '|' + tblInsurance.rows.item(i).cells[2].innerText.trim()
            // document.getElementById(anchor_id).click();
         }
         else {
            alert('You have not selected any record to delete!')
            return;
         }
      }
      pathname = `/bima_policy/policy/${ids}/delete`

      window.location.replace(window.location.origin + pathname)
   }

   function resertDocument() {
      document.location.reload()
   }

   function highlight(row) {

      SelectedRow = row.cells[0].textContent;
      deHighlight();
      row.style.background = "darkgray"
      row.style.color = 'black'
      row.classList.toggle("selectedRow");

      var anchorTag = row.getElementsByTagName('a'); // Replace 'a' with the appropriate tag name     

      if (anchorTag) {
         for (const iterator of anchorTag) {

            // iterator.style.color = "white"
         }
      }
   }

   function deHighlight() {
      let table = document.getElementById("tblInsurance");
      let rows = table.rows;
      for (let i = 0; i < rows.length; i++) {
         // to avoid checked 
         try {
            is_checked = document.getElementById(`chkblkrm${i}`).checked
            if (is_checked) {
               continue;
            }
         } catch { }

         // rows[i].style.background = "#FFFFFF";
         rows[i].style.background = "";
         // rows[i].style.color = "black";

         var anchorTag = rows[i].getElementsByTagName('a'); // Replace 'a' with the appropriate tag name     

         if (anchorTag) {
            for (const iterator of anchorTag) {
               // iterator.style.color = "black"
            }
         }
      }
   }

   function searchName() {

      // Declare variables
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("myInput");
      filter = input.value.toUpperCase();
      table = document.getElementById("tblInsurance");
      tr = table.getElementsByTagName("tr");

      // Loop through all table rows, and hide those who don't match the search query
      for (i = 0; i < tr.length; i++) {
         td = tr[i].getElementsByTagName("td")[3];
         if (td) {
            txtValue = td.textContent || td.innerText;
            // console.log(txtValue);
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
               tr[i].style.display = "";
            } else {
               // tr[i].style.display = "none";

               td4 = tr[i].getElementsByTagName("td")[4];

               if (td4) {
                  txtValue = td4.textContent || td4.innerText;
                  // console.log(txtValue);
                  if (txtValue.toUpperCase().indexOf(filter) > -1) {
                     tr[i].style.display = "";
                  } else {
                     // tr[i].style.display = "none";

                     td5 = tr[i].getElementsByTagName("td")[5];

                     if (td5) {
                        txtValue = td5.textContent || td5.innerText;
                        // console.log(txtValue);
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                           tr[i].style.display = "";
                        } else {
                           tr[i].style.display = "none";

                        }
                     }

                  }
               }

            }
         }
      }
   }

   function clearFilterList() {

      filterList = []
      filterListMultiple = []
      isMultiFilter = false
      rowList = []

      policyid_list = []
      payoutValues = []

      freezList = []

      generateTableRowsAsync(fetchList)

      addFilterTypes()
   }

   function getCellName() {

      value = document.getElementById('filter_type').value

      cell_no = 0

      if (value == 'agent') {
         cell_no = '-ag'
      }
      else if (value == 'insurer') {
         cell_no = '-ins'
      }
      else if (value == 'vehicle_catagory') {
         cell_no = "-vc"
      }
      else if (value == 'vehicle_makeby') {
         cell_no = "-vmb"
      }
      else if (value == 'vehicle_model') {
         cell_no = "-vmm"
      }
      else if (value == 'fuel_type') {
         cell_no = "-ft"
      }
      else if (value == 'cc') {
         cell_no = "-cc"
      }
      else if (value == 'sc') {
         cell_no = "-sc"
      }
      else if (value == 'ct') {
         cell_no = "-ct"
      }
      else if (value == 'gvw') {
         cell_no = "-gvw"
      }
      else if (value == 'policy_type') {
         cell_no = "-pt"
      }
      else if (value == 'addon') {
         cell_no = "-addon"
      }
      else if (value == 'ncb') {
         cell_no = "-ncb"
      }
      else if (value == 'cpa') {
         cell_no = "-cpa"
      }

      return cell_no
   }

   function addName3() {
      // Declare variables

      console.log('addName3');

      filter_content = document.getElementById('filter_content')

      tempfilterList = []

      for (i = 1; i <= filter_content.options.length - 1; i++) {

         if (filter_content.options[i].selected == true) {

            posCode = filter_content.options[i].value.split('|')[0].trim()

            tempfilterList.push(posCode)
         }
      }

      console.log(tempfilterList);

      filter_type = document.getElementById('filter_type').value

      console.log(filter_type);

      filterList = []

      if (filter_type == "agent") {

         for (const iterator of fetchList) {

            pos = iterator.pos

            for (const tempItr of tempfilterList) {

               if (tempItr == pos) {
                  filterList.push(iterator)
                  console.log(tempItr);
               }
            }

         }
      }

      console.log(filterList);

      generateTableRowsAsync(filterList)


      return


      isMultiFilter = true

      value = document.getElementById('filter_type').value

      filter_content = document.getElementById('filter_content')

      tempfilterList = []

      for (i = 1; i <= filter_content.options.length - 1; i++) {

         if (filter_content.options[i].selected == true) {

            val = filter_content.options[i].value.toString()

            if (val.includes("/")) {

               val = val.replace("/", "--")

            }

            // tempfilterList.push(filter_content.options[i].value)
            tempfilterList.push(val)
         }
      }

      const objj = { index: getCellName(), items: tempfilterList }
      is_found = filterListMultiple.find(item => item.index == objj.index)

      if (is_found == null) {
         filterListMultiple.push(obj)
      }
      else {
         // alert('This option already exists in filter list!')
      }
      console.log(filterListMultiple);

      return filterListMultiple
   }

   function searchName2() {


      jsonData = ''

      if (isMultiFilter) {
         addName3()
         jsonData = JSON.stringify(filterListMultiple);
      }
      else {
         addName2()
         withDateList = []
         withDateList.push(filter_date_list)
         withDateList.push(filterList)
         jsonData = JSON.stringify(withDateList);
      }

      filter_content = document.getElementById('filter_content')
      if (filter_content.options.length == 1) {
         alert('You have not selected any filter option! ')
         return;
      }

      pathname = '/bima_policy/policy/entry_list'

      href = window.location.origin + pathname

      console.log('filterlist: ' + jsonData);

      $.ajax({
         url: href,
         type: 'POST',
         beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
         },
         data: { 'data': jsonData },
         dataType: 'json',
         success: function (response) {
            responseHandler(response)
         },
         error: function (xhr, status, error) {
            // Handle any errors that occurred during the request
            console.log('error occurred ', error);
         }
      });


   }

   function ExportToExcel_Original(type, fn, dl) {
      var elt = document.getElementById('tblInsurance');
      var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
      return dl ?
         XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
         XLSX.writeFile(wb, fn || ('MySheetName.' + (type || 'xlsx')));
   }

   function setOD() {

      val_aod = document.getElementById('a_od_reward').value.trim()
      val_atp = document.getElementById('a_tp_reward').value.trim()
      val_sod = document.getElementById('s_od_reward').value.trim()
      val_stp = document.getElementById('s_tp_reward').value.trim()

      payoutValues = []

      if (val_aod != '') {
         payoutValues.push(val_aod)
      }
      if (val_atp != '') {
         payoutValues.push(val_atp)
      }
      if (val_sod != '') {
         payoutValues.push(val_sod)
      }
      if (val_stp != '') {
         payoutValues.push(val_stp)
      }

      return payoutValues.length
      // console.log(payoutValues);
   }

   function showMoreFilters() {
      if (document.getElementById('morefilters').hidden) {
         document.getElementById('morefilters').hidden = false
         document.getElementById('filter_type').selectedIndex = 0
         add_filter_type()

      }
      else {
         document.getElementById('morefilters').hidden = true
      }
   }

   function entry_filter() {

      searchText = document.getElementById('myInput').value.trim()

      if (searchText != "") {
         fetchRecord(searchText)
         return
      }

      val1 = document.getElementById('frmDate').value
      val2 = document.getElementById('toDate').value

      if (String(val1) == "") {
         val1 = val2
      }

      d1 = String(val1).replace('/', '-').replace('/', '-').replace('/', '-')
      d2 = String(val2).replace('/', '-').replace('/', '-').replace('/', '-')


      fetch_records(d1 + '|' + d2)

      return
      search_value = document.getElementById('myInput').value.trim()
      if (search_value != "") {
         if (search_value.includes("/")) {
            search_value = search_value.replaceAll("/", "--")
         }
         url = window.location.origin + '/bima_policy/policy/search_entry/' + search_value

         window.location.replace(url)
         return
      }

      val1 = document.getElementById('frmDate').value
      val2 = document.getElementById('toDate').value

      if (String(val1) == "") {
         val1 = val2
      }

      d1 = String(val1).replace('/', '-').replace('/', '-').replace('/', '-')
      d2 = String(val2).replace('/', '-').replace('/', '-').replace('/', '-')

      date_list = []
      date_list.push(d1)
      date_list.push(d2)

      main_list = []

      if (filterListMultiple.length > 0) {

         main_list.push(date_list)

         main_list.push(filterListMultiple)

         jsonData = JSON.stringify(main_list);

         isChecked = document.getElementById('ps1').checked
         if (isChecked) {
            main_list.push("y")
            jsonData = JSON.stringify(main_list);
         }
         else {

            main_list.push("n")
            jsonData = JSON.stringify(main_list);
         }
      }
      else {

         main_list.push(date_list)

         jsonData = JSON.stringify(main_list);
      }

      console.log('jsonData: ' + jsonData);
      // alert(jsonData)

      url = window.location.origin + '/bima_policy/policy/entry/' + jsonData

      window.location.replace(url)
      return;

      $.ajax({
         url: window.location.origin + '/bima_policy/policy/entry_filter',
         type: 'POST',
         beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
         },
         data: { 'data': jsonData },
         dataType: 'json',
         success: function (response) {
            console.log(response);
            entry_filter_response_handler(response)
            // alert('call done')

         },
         error: function (xhr, status, error) {
            // Handle any errors that occurred during the request
            console.log('error occurred ', error);
         }
      });


   }

   function entry_filter_response_handler(response) {

      console.log('entry_filter_response_handler method');
      responsedata = JSON.parse(JSON.stringify(response.data))
      console.log(responsedata);

      document.getElementById("thCheck").hidden = true
      document.getElementById("tbdy").innerHTML = '';
      c = []
      policyid_list = []   // to update all payout record
      responsedata.forEach(element => {
         policyid_list.push(element['policyid'])
      });

      console.log('resp length ' + responsedata.length);

      initialResponse = [] // for storing for navigation and gen table row
      index = 0
      responsedata.forEach(element => {
         index++;
         initialResponse.push({ "index": index, "element": element })

         // console.log({ "index": index, "element": element });

         if (index <= 100) {
            curIndex = generate_row(index, element)
         }
      });

      if (policyid_list.length == 0) {

         document.getElementById("btnUpdatePayout").disabled


      } else {
         document.getElementById("btnUpdatePayout").disabled = false

      }
      document.getElementById('link_gen').hidden = false
      // document.getElementById('link_gen').hidden= false


      // console.log('policyid_list ' + policyid_list);
      // console.log('policyid_list ind ' + initialResponse[0]['element']['customer_name']);
      // console.log('policyid_list ind ' + initialResponse.length);
   }

   function generate_row(index, item) {

      console.log('gen row');
      c.push("<tr>");
      c.push("<td>" + index + "</td>");
      // c.push("<td>" + "</td>");
      c.push("<td>" + item.policyid + "</td>");
      c.push("<td>" + item.proposal_no + "</td>");
      c.push("<td>" + item.policy_no + "</td>");
      c.push("<td>" + item.customer_name + "</td>");
      c.push("<td>" + item.insurance_company + "</td>");
      c.push("<td>" + item.sp_name + "</td>");
      c.push("<td>" + item.sp_brokercode + "</td>");
      c.push("<td>" + item.product_name + "</td>");
      c.push("<td>" + item.registration_no + "</td>");
      c.push("<td>" + item.rto_state + "</td>");
      c.push("<td>" + item.rto_city + "</td>");
      c.push("<td>" + item.vehicle_makeby + "</td>");
      c.push("<td>" + item.vehicle_model + "</td>");
      c.push("<td>" + item.vehicle_catagory + "</td>");
      c.push("<td>" + item.vehicle_fuel_type + "</td>");
      c.push("<td>" + item.mfg_year + "</td>");
      c.push("<td>" + item.addon + "</td>");
      c.push("<td>" + item.ncb + "</td>");
      c.push("<td>" + item.cubic_capacity + "</td>");
      c.push("<td>" + item.gvw + "</td>");
      c.push("<td>" + item.seating_capacity + "</td>");
      c.push("<td>" + item.coverage_type + "</td>");
      c.push("<td>" + item.policy_type + "</td>");
      c.push("<td>" + item.cpa + "</td>");
      c.push("<td>" + item.risk_start_date + "</td>");
      c.push("<td>" + item.risk_end_date + "</td>");
      c.push("<td>" + item.issue_date + "</td>");
      c.push("<td>" + item.insured_age + "</td>");
      c.push("<td>" + item.policy_term + "</td>");
      c.push("<td>" + item.bqp + "</td>");
      c.push("<td>" + item.pos + "</td>");
      c.push("<td>" + item.employee + "</td>");
      c.push("<td>" + item.remark + "</td>");
      c.push("<td>" + item.OD_premium + "</td>");
      c.push("<td>" + item.TP_terrorism + "</td>");
      c.push("<td>" + item.net + "</td>");
      c.push("<td>" + item.gst_amount + "</td>");
      c.push("<td>" + item.gst_gcv_amount + "</td>");
      c.push("<td>" + item.total + "</td>");
      c.push("<td>" + item.payment_mode + "</td>");
      c.push("<td>" + item.agent_od_reward + "</td>");
      c.push("<td>" + item.agent_od_amount + "</td>");
      c.push("<td>" + item.agent_tp_reward + "</td>");
      c.push("<td>" + item.agent_tp_amount + "</td>");

      c.push("<td>" + item.self_od_reward + "</td>");
      c.push("<td>" + item.self_od_amount + "</td>");
      c.push("<td>" + item.self_tp_reward + "</td>");
      c.push("<td>" + item.self_tp_amount + "</td>");

      c.push("<td>" + item.proposal + "</td>");
      c.push("<td>" + item.mandate + "</td>");
      c.push("<td>" + item.policy + "</td>");
      c.push("<td>" + item.previous_policy + "</td>");
      c.push("<td>" + item.pan_card + "</td>");
      c.push("<td>" + item.aadhar_card + "</td>");
      c.push("<td>" + item.vehicle_rc + "</td>");
      c.push("<td>" + item.inspection_report + "</td>");

      c.push("</tr>");

      // tblInsurance

      $('#tbdy').html(c.join(""));

      return index
   }

   function applyPayouts() {
      console.log('applyPayouts method calling:');

      plist = "{{ policyid_list | safe}}"

      if (plist.length < 1) {
         alert('Please filter again and apply payout')
         return;
      }
      // Declare variables
      // print(filterList)    
      len = setOD()

      if (len != 4) {
         alert('Payout values error')
         return
      }
      pVal_pList = []

      pVal_pList.push(payoutValues)

      plist = "{{ policyid_list | safe}}"

      console.log(plist);

      // return;
      pVal_pList.push(plist)

      console.log(pVal_pList);

      jsonData = ''
      // alert('here')
      jsonData = JSON.stringify(pVal_pList);

      url = window.location.origin + '/bima_policy/policy/entry/' + jsonData

      window.location.replace(url)

      return

      pathname = '/bima_policy/policy/entry_list_update'

      href = window.location.origin + pathname

      $.ajax({
         url: href,
         type: 'POST',
         beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
         },
         data: { 'data': jsonData },
         dataType: 'json',
         success: function (response) {
            // responseHandlerForPayout(response)
            entry_filter_response_handler(response)
         },
         error: function (xhr, status, error) {
            // Handle any errors that occurred during the request
            console.log('error occurred ', error);
         }
      });
   }


   function responseHandlerForPayoutobs(response) {
      console.log('responseHandlerForPayout method calling: ');
      // console.log(response.data);
      // console.log(response.data[0]);
      var ytt = JSON.parse(JSON.stringify(response.data))
      console.log(ytt);

      // th_coll = document.getElementsByClassName("sorting");
      // for (const item of th_coll) {
      //    item.hidden = true
      // }
      // th_coll = document.getElementsByClassName("thShow");
      // for (const item of th_coll) {
      //    item.hidden = false
      // }

      document.getElementById("tbdy").innerHTML = '';
      c = []

      console.log(policyid_list);

      index = 0
      ytt.forEach(element => {
         // Creating table row
         index++;
         generate_row(index, element)

      });

   }

   function gen_table() {
      console.log('gen_table method');

      c_index = curIndex;
      total_length = initialResponse.length;

      // alert(c_index)
      // alert(total_length)

      if (total_length > c_index) {

         // alert(total_length -curIndex )
      }
      else {
         alert('No more pages available!')
         return
      }

      document.getElementById("tbdy").innerHTML = '';
      c = []

      tmplist = []

      // next_index = curIndex + 9
      next_index = curIndex + 99
      // next_index = c_index + (total_length-c_index)

      for (index = curIndex; index <= next_index; index++) {

         tmplist.push(initialResponse[index])
      }

      console.log(tmplist);

      tmplist.forEach(element => {

         returned_index = generate_row(element['index'], element['element'])
         console.log('element index ' + returned_index);

      });

      curIndex = next_index + 1

      console.log('ele_index ' + returned_index);

   }

   function getLength() {

   }


   function entry_filter_loader() {

      // Adding date for filter
      val1 = document.getElementById('frmDate').value
      val2 = document.getElementById('toDate').value

      d1 = String(val1).replace('/', '-').replace('/', '-').replace('/', '-')
      d2 = String(val2).replace('/', '-').replace('/', '-').replace('/', '-')

      filter_date_list = []
      filter_date_list.push(d1)
      filter_date_list.push(d2)

      console.log('val1 ', d1);
      console.log('val2 ', d2);

      jsonData = JSON.stringify(filter_date_list);

      console.log('json data: ', jsonData);


      url = window.location.origin + '/bima_policy/policy/entry/' + jsonData

      window.location.replace(url)

      return;
      // Adding date for filter
      val1 = document.getElementById('frmDate').value
      val2 = document.getElementById('toDate').value
      filter_date_list = []
      filter_date_list.push(val1)
      filter_date_list.push(val2)

      // Adding other filter
      withDateList = []

      if (document.getElementById('morefilters').hidden) {
         withDateList.push(filter_date_list)
         jsonData = JSON.stringify(withDateList);
      }
      else {
         // alert(filterList.length)
         // addName3()
         withDateList.push(filter_date_list)
         withDateList.push(filterListMultiple)

         jsonData = JSON.stringify(withDateList);

         isChecked = document.getElementById('ps1').checked
         if (isChecked) {
            withDateList.push('y')
            jsonData = JSON.stringify(withDateList);
         }
      }


      console.log('jsonData: ' + jsonData);

      $.ajax({
         url: window.location.origin + '/bima_policy/policy/entry/last_month',
         type: 'GET',
         beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
         },
         data: { 'data': jsonData },
         dataType: 'json',
         success: function (response) {
            console.log(response);
            entry_filter_response_handler(response)
            // alert('call done')

         },
         error: function (xhr, status, error) {
            // Handle any errors that occurred during the request
            console.log('error occurred ', error);
         }
      });


   }


   function ExportToExcel(type, fn, dl) {

      var elt = document.getElementById('tblInsurance');
      var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
      return dl ?
         XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
         XLSX.writeFile(wb, fn || ('MySheetName.' + (type || 'xlsx')));
   }


   function addAgentNames() {

      document.getElementById('filter_content').innerHTML = ''

      add_select_all_option()

      element = document.getElementById('filter_content')

      agents = JSON.parse(localStorage.getItem('agents'));

      agents.forEach(item => {
         var newoption = document.createElement("option");
         newoption.value = item.trim()
         newoption.innerHTML = item.trim()
         element.options.add(newoption);
      })
   }


   function addInsurerNames() {

      document.getElementById('filter_content').innerHTML = ''

      add_select_all_option()

      element = document.getElementById('filter_content')

      insurers = JSON.parse(localStorage.getItem('insurers'));

      insurers.forEach(item => {
         var newoption = document.createElement("option");
         newoption.value = item
         newoption.innerHTML = item
         element.options.add(newoption);
      })
   }


   function addVehicleCat() {

      document.getElementById('filter_content').innerHTML = ''

      add_select_all_option()

      element = document.getElementById('filter_content')

      vehicle_categories = JSON.parse(localStorage.getItem('vehicle_categories'));

      vehicle_categories.forEach(item => {
         var newoption = document.createElement("option");
         newoption.value = item
         newoption.innerHTML = item
         element.options.add(newoption);
      })
   }


   function addVehicleMakes() {

      document.getElementById('filter_content').innerHTML = ''

      add_select_all_option()

      element = document.getElementById('filter_content')

      makes = JSON.parse(localStorage.getItem('makes'));

      makes.forEach(item => {
         var newoption = document.createElement("option");
         newoption.value = item.make
         newoption.innerHTML = item.make
         element.options.add(newoption);
      })

   }


   function addVehicleModels() {

      document.getElementById('filter_content').innerHTML = ''

      add_select_all_option()

      element = document.getElementById('filter_content')

      models = JSON.parse(localStorage.getItem('models'));

      models.forEach(item => {
         var newoption = document.createElement("option");
         newoption.value = item.model
         newoption.innerHTML = item.model
         element.options.add(newoption);
      })
   }

   function downloadFile(params) {
      // alert(params)
      if (params.includes("/")) {
         index = params.lastIndexOf("/") + 1
         params = params.substring(index, params.length);
      }
      pathname = '/bima_policy/docs/download/' + params
      href = window.location.origin + pathname
      window.open(href)

   }


   function fetchRecord(searchText) {

      $.ajax({
         url: "{%url 'bima_policy:fetch_record'%}",
         data: { data: searchText },
         dataType: 'json',
         success: function (response) {
            record = response.record
            console.log(record);


            console.log(fetchList);

            if (record === undefined) {
               showNotification('❌ No RECORD FOUND! ');
               return
            }

            generateSingleRowsAsync(record[0])

         },
         error: function (xhr, status, error) {
            console.error(error);
            alert(error.toString())
         }
      });

      showNotification('⌛️ Getting ready...')
   }

   function generateSingleRowsAsync(record) {
      tableRows = ''
      document.getElementById('tbdy').innerHTML = ''

      recordHtml = '<tr class="policy-row" onclick="highlight(this)"  >' +
         '<td class="text-center" > ' + 1 + '</td>' +
         '<td >' + record.proposal_no + '</td>' +
         `<td > <a href="" class="tile tile-img" target="_blank"><i class="far fa-file-pdf text-danger mt-1"></i></a> <a href="/bima_policy/policy/policy_entrydata/${record.policyid}" class=""> ${record.policy_no}</a> </td>` +
         '<td >' + record.customer_name + '</td>' +
         '<td >' + record.insurance_company + '</td>' +
         '<td >' + record.sp_name + '</td>' +
         '<td >' + record.sp_brokercode + '</td>' +
         '<td >' + record.product_name + '</td>' +
         '<td >' + record.registration_no + '</td>' +
         '<td >' + record.rto_state + '</td>' +
         '<td >' + record.rto_city + '</td>' +
         '<td >' + record.vehicle_makeby + '</td>' +
         '<td >' + record.vehicle_model + '</td>' +
         '<td >' + record.vehicle_catagory + '</td>' +
         '<td >' + record.vehicle_fuel_type + '</td>' +
         '<td >' + record.mfg_year + '</td>' +

         '<td >' + record.addon + '</td>' +
         '<td >' + record.ncb + '</td>' +
         '<td >' + record.cubic_capacity + '</td>' +
         '<td >' + record.gvw + '</td>' +
         '<td >' + record.seating_capacity + '</td>' +
         '<td >' + record.coverage_type + '</td>' +
         '<td >' + record.policy_type + '</td>' +
         '<td >' + record.cpa + '</td>' +
         '<td >' + record.risk_start_date + '</td>' +
         '<td >' + record.risk_end_date + '</td>' +
         '<td >' + record.issue_date + '</td>' +

         '<td >' + record.insured_age + '</td>' +
         '<td >' + record.policy_term + '</td>' +
         '<td >' + record.bqp + '</td>' +
         '<td >' + record.pos + '</td>' +
         '<td >' + record.employee + '</td>' +
         '<td >' + record.remark + '</td>' +

         '<td >' + record.OD_premium + '</td>' +
         '<td >' + record.TP_terrorism + '</td>' +
         '<td >' + record.net + '</td>' +
         '<td >' + record.gst_amount + '</td>' +
         '<td >' + record.gst_gcv_amount + '</td>' +
         '<td >' + record.total + '</td>' +
         '<td >' + record.payment_mode + '</td>' +

         '<td >' + record.agent_od_reward + '</td>' +
         '<td >' + record.agent_od_amount + '</td>' +
         '<td >' + record.agent_tp_reward + '</td>' +
         '<td >' + record.agent_tp_amount + '</td>' +

         '<td >' + record.self_od_reward + '</td>' +
         '<td >' + record.self_od_amount + '</td>' +
         '<td >' + record.self_tp_reward + '</td>' +
         '<td >' + record.self_tp_amount + '</td>' +

         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.proposal}')">${record.proposal}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.mandate}')">${record.mandate}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.policy}')">${record.policy}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.previous_policy}')">${record.previous_policy}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.pan_card}')">${record.pan_card}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.aadhar_card}')">${record.aadhar_card}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.vehicle_rc}')">${record.vehicle_rc}</a> </td>` +
         `<td class="text-center" > <a href="#" onclick="downloadFile('${record.inspection_report}')">${record.inspection_report}</a> </td>` +

         `<td class="text-center"> <form method="POST">   {% csrf_token %}
         <a href="/bima_policy/policy/policy_entrydata/${record.policyid}"
            class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary" name="Edit">
            <i class="fa fa-pencil-alt mt-2"></i>                                               
         </a>
         <a href="/bima_policy/deleted_policy/${record.policyid}" name="Remove"
            class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary text-danger">
            <i class="far fa-trash-alt mt-2"></i> 
         </a>
   </td>` +

         '</tr>';

      tableRows += recordHtml;

      showNotification('✅ TOTAL POLICIES: ' + 1);
      document.getElementById('tbdy').innerHTML = tableRows;
      // showNextRows(true)
   }

   function generateTableRowsAsync(records) {
      tableRows = ''
      document.getElementById('tbdy').innerHTML = ''

      if (records.length === 0) {
         showNotification('❌ ' + 'NO POLICIES!');
         return
      }

      for (var i = 0; i < records.length; i++) {

         record = records[i]

         recordHtml = '<tr class="policy-row" onclick="highlight(this)"  >' +
            '<td class="text-center" > ' + (i + 1) + '</td>' +
            '<td >' + record.proposal_no + '</td>' +
            `<td > <a href="" class="tile tile-img" target="_blank"><i class="far fa-file-pdf text-danger mt-1"></i></a> <a href="/bima_policy/policy/policy_entrydata/${record.policyid}" class=""> ${record.policy_no}</a> </td>` +
            '<td >' + record.customer_name + '</td>' +
            '<td >' + record.insurance_company + '</td>' +
            '<td >' + record.sp_name + '</td>' +
            '<td >' + record.sp_brokercode + '</td>' +
            '<td >' + record.product_name + '</td>' +
            '<td >' + record.registration_no + '</td>' +
            '<td >' + record.rto_state + '</td>' +
            '<td >' + record.rto_city + '</td>' +
            '<td >' + record.vehicle_makeby + '</td>' +
            '<td >' + record.vehicle_model + '</td>' +
            '<td >' + record.vehicle_catagory + '</td>' +
            '<td >' + record.vehicle_fuel_type + '</td>' +
            '<td >' + record.mfg_year + '</td>' +

            '<td >' + record.addon + '</td>' +
            '<td >' + record.ncb + '</td>' +
            '<td >' + record.cubic_capacity + '</td>' +
            '<td >' + record.gvw + '</td>' +
            '<td >' + record.seating_capacity + '</td>' +
            '<td >' + record.coverage_type + '</td>' +
            '<td >' + record.policy_type + '</td>' +
            '<td >' + record.cpa + '</td>' +
            '<td >' + record.risk_start_date + '</td>' +
            '<td >' + record.risk_end_date + '</td>' +
            '<td >' + record.issue_date + '</td>' +

            '<td >' + record.insured_age + '</td>' +
            '<td >' + record.policy_term + '</td>' +
            '<td >' + record.bqp + '</td>' +
            '<td >' + record.pos + '</td>' +
            '<td >' + record.employee + '</td>' +
            '<td >' + record.remark + '</td>' +

            '<td >' + record.OD_premium + '</td>' +
            '<td >' + record.TP_terrorism + '</td>' +
            '<td >' + record.net + '</td>' +
            '<td >' + record.gst_amount + '</td>' +
            '<td >' + record.gst_gcv_amount + '</td>' +
            '<td >' + record.total + '</td>' +
            '<td >' + record.payment_mode + '</td>' +

            '<td >' + record.agent_od_reward + '</td>' +
            '<td >' + record.agent_od_amount + '</td>' +
            '<td >' + record.agent_tp_reward + '</td>' +
            '<td >' + record.agent_tp_amount + '</td>' +

            '<td >' + record.self_od_reward + '</td>' +
            '<td >' + record.self_od_amount + '</td>' +
            '<td >' + record.self_tp_reward + '</td>' +
            '<td >' + record.self_tp_amount + '</td>' +

            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.proposal}')">${record.proposal}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.mandate}')">${record.mandate}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.policy}')">${record.policy}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.previous_policy}')">${record.previous_policy}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.pan_card}')">${record.pan_card}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.aadhar_card}')">${record.aadhar_card}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.vehicle_rc}')">${record.vehicle_rc}</a> </td>` +
            `<td class="text-center" > <a href="#" onclick="downloadFile('${record.inspection_report}')">${record.inspection_report}</a> </td>` +

            `<td class="text-center"> <form method="POST">   {% csrf_token %}
         <a href="/bima_policy/policy/policy_entrydata/${record.policyid}"
            class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary" name="Edit">
            <i class="fa fa-pencil-alt mt-2"></i>                                               
         </a>
         <a href="/bima_policy/deleted_policy/${record.policyid}" name="Remove"
            class="mr-1 mt-1 btn btn-sm btn-icon btn-secondary text-danger">
            <i class="far fa-trash-alt mt-2"></i> 
         </a>
   </td>` +

            '</tr>';

         tableRows += recordHtml;
      }

      showNotification('✅ TOTAL POLICIES: ' + records.length);
      document.getElementById('tbdy').innerHTML = tableRows;
      showNextRows(true)
   }

   function showNextRows(hideDefault) {

      event.preventDefault()

      var selectElement = document.getElementById("select_length");
      var selectedValue = selectElement.value;

      var rows = document.getElementsByClassName("policy-row");

      if (selectedValue == 0) {

         for (var i = 0; i < rows.length; i++) {
            rows[i].style.display = ""; // Show the row
         }
         return
      }

      rows = document.getElementsByClassName("policy-row");

      if (hideDefault) {
         for (var i = 0; i < rows.length; i++) {
            if (i < selectedValue) {
               rows[i].style.display = ""; // Show the row
               curIndex = i
            }
            else {
               rows[i].style.display = "none"; // Show the row
            }
         }
         if (rows.length === curIndex + 1)
            document.getElementById("nextButton").hidden = true;
         else
            document.getElementById("nextButton").hidden = false;
         return
      }

      from = curIndex;
      to = from + Number(selectedValue)

      for (var i = from; i <= to; i++) {
         if (rows[i]) {
            rows[i].style.display = ""; // Show the row
            curIndex = i
         }
         else {
            console.log('no more rows to show');
            break
         }
      }

      $('html, body').animate({ scrollTop: $('#nextButton').offset().top }, 1);

      if (rows.length === curIndex + 1)
         document.getElementById("nextButton").hidden = true;
      else
         document.getElementById("nextButton").hidden = false;

   }

   function searchPol(event) {
      if (event.key === "Enter") {
         entry_filter()
      }
   }

   function addToFilterList() {

      filter_type = document.getElementById('filter_type')

      showNotification(`⌛️ You have Freezed ${filter_type.value}`.toUpperCase())

      for (i = 0; i < filter_type.options.length; i++) {

         if (filter_type.options[i].value == filter_type.value) {
            filter_type.options[i].remove()
         }
      }

      filter_type.selectedIndex = 0

      add_filter_type()

      freezList = filterList

      // console.log('freez list: ', freezList);

   }

   function filterFetchList() {

      filter_type = document.getElementById('filter_type').value
      filter_content = document.getElementById('filter_content')

      console.log(filter_type);

      if (freezList.length > 0) {

         tempfilterList = []

         for (i = 1; i <= filter_content.options.length - 1; i++) {

            if (filter_content.options[i].selected == true) {
               tempfilterList.push(filter_content.options[i].value.trim())
            }
         }

         filterList = []

         if (filter_type == "pos") {

            for (const iterator of freezList) {

               pos = iterator.pos

               for (const tempItr of tempfilterList) {

                  poscode = tempItr.split('|')[0].trim()

                  if (poscode == pos) {
                     filterList.push(iterator)
                  }
               }
            }

            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "insurance_company") {

            for (const iterator of freezList) {

               insurance_company = iterator.insurance_company

               for (const tempItr of tempfilterList) {

                  if (tempItr == insurance_company) {
                     filterList.push(iterator)
                     // console.log(tempItr);
                  }
               }

            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_catagory") {

            for (const iterator of freezList) {

               vehicle_catagory = iterator.vehicle_catagory

               for (const tempItr of tempfilterList) {

                  if (tempItr == vehicle_catagory) {
                     filterList.push(iterator)
                     // console.log(tempItr);
                  }
               }

            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_makeby") {
            for (const iterator of freezList) {
               vehicle_makeby = iterator.vehicle_makeby
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_makeby) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_model") {
            for (const iterator of freezList) {
               vehicle_model = iterator.vehicle_model
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_model) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_fuel_type") {
            for (const iterator of freezList) {
               vehicle_fuel_type = iterator.vehicle_fuel_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_fuel_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "cubic_capacity") {
            for (const iterator of freezList) {
               cubic_capacity = iterator.cubic_capacity
               for (const tempItr of tempfilterList) {
                  if (tempItr == cubic_capacity) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "seating_capacity") {
            for (const iterator of freezList) {
               seating_capacity = iterator.seating_capacity
               for (const tempItr of tempfilterList) {
                  if (tempItr == seating_capacity) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "coverage_type") {
            for (const iterator of freezList) {
               coverage_type = iterator.coverage_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == coverage_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "gvw") {
            for (const iterator of freezList) {
               gvw = iterator.gvw
               for (const tempItr of tempfilterList) {
                  if (tempItr == gvw) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "policy_type") {
            for (const iterator of freezList) {
               policy_type = iterator.policy_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == policy_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "addon") {
            for (const iterator of freezList) {
               addon = iterator.addon
               for (const tempItr of tempfilterList) {
                  if (tempItr == addon) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "ncb") {
            for (const iterator of freezList) {
               ncb = iterator.ncb
               for (const tempItr of tempfilterList) {
                  if (tempItr == ncb) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "cpa") {
            for (const iterator of freezList) {
               cpa = iterator.cpa
               for (const tempItr of tempfilterList) {
                  if (tempItr == cpa) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }


      }

      else {

         tempfilterList = []

         for (i = 1; i <= filter_content.options.length - 1; i++) {

            if (filter_content.options[i].selected == true) {
               tempfilterList.push(filter_content.options[i].value.trim())
            }
         }

         console.log(tempfilterList);

         filterList = []

         if (filter_type == "pos") {

            for (const iterator of fetchList) {

               pos = iterator.pos

               for (const tempItr of tempfilterList) {

                  poscode = tempItr.split('|')[0].trim()

                  if (poscode == pos) {

                     filterList.push(iterator)
                  }
               }
            }

            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "insurance_company") {

            for (const iterator of fetchList) {

               insurance_company = iterator.insurance_company

               for (const tempItr of tempfilterList) {

                  if (tempItr == insurance_company) {
                     filterList.push(iterator)
                     // console.log(tempItr);
                  }
               }

            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_catagory") {

            for (const iterator of fetchList) {

               vehicle_catagory = iterator.vehicle_catagory

               for (const tempItr of tempfilterList) {

                  if (tempItr == vehicle_catagory) {
                     filterList.push(iterator)
                     // console.log(tempItr);
                  }
               }

            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_makeby") {
            for (const iterator of fetchList) {
               vehicle_makeby = iterator.vehicle_makeby
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_makeby) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_model") {
            for (const iterator of fetchList) {
               vehicle_model = iterator.vehicle_model
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_model) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "vehicle_fuel_type") {
            for (const iterator of fetchList) {
               vehicle_fuel_type = iterator.vehicle_fuel_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == vehicle_fuel_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "cubic_capacity") {
            for (const iterator of fetchList) {
               cubic_capacity = iterator.cubic_capacity
               for (const tempItr of tempfilterList) {
                  if (tempItr == cubic_capacity) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "seating_capacity") {
            for (const iterator of fetchList) {
               seating_capacity = iterator.seating_capacity
               for (const tempItr of tempfilterList) {
                  if (tempItr == seating_capacity) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "coverage_type") {
            for (const iterator of fetchList) {
               coverage_type = iterator.coverage_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == coverage_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "gvw") {
            for (const iterator of fetchList) {
               gvw = iterator.gvw
               for (const tempItr of tempfilterList) {
                  if (tempItr == gvw) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "policy_type") {
            for (const iterator of fetchList) {
               policy_type = iterator.policy_type
               for (const tempItr of tempfilterList) {
                  if (tempItr == policy_type) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "addon") {
            for (const iterator of fetchList) {
               addon = iterator.addon
               for (const tempItr of tempfilterList) {
                  if (tempItr == addon) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "ncb") {
            for (const iterator of fetchList) {
               ncb = iterator.ncb
               for (const tempItr of tempfilterList) {
                  if (tempItr == ncb) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

         if (filter_type == "cpa") {
            for (const iterator of fetchList) {
               cpa = iterator.cpa
               for (const tempItr of tempfilterList) {
                  if (tempItr == cpa) {
                     filterList.push(iterator)
                  }
               }
            }
            generateTableRowsAsync(filterList)
            return
         }

      }
   }

   function addFilterTypes() {

      filter_type = document.getElementById('filter_type')
      filter_type.innerHTML = ''

      var newoption = document.createElement("option");
      newoption.value = 'pos'
      newoption.innerHTML = 'POSPS'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'insurance_company'
      newoption.innerHTML = 'Insurers'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'vehicle_catagory'
      newoption.innerHTML = 'vehicle catagory'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'vehicle_makeby'
      newoption.innerHTML = 'vehicle makeby'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'vehicle_model'
      newoption.innerHTML = 'vehicle model'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'vehicle_fuel_type'
      newoption.innerHTML = 'fuel type'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'cubic_capacity'
      newoption.innerHTML = 'cubic capacity'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'seating_capacity'
      newoption.innerHTML = 'seating capacity'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'coverage_type'
      newoption.innerHTML = 'coverage type'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'gvw'
      newoption.innerHTML = 'gvw'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'policy_type'
      newoption.innerHTML = 'policy type'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'addon'
      newoption.innerHTML = 'addon'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'ncb'
      newoption.innerHTML = 'ncb'
      filter_type.options.add(newoption);

      newoption = document.createElement("option");
      newoption.value = 'cpa'
      newoption.innerHTML = 'cpa'
      filter_type.options.add(newoption);


   }

   function loadRecordLocalStorage() {
      // console.log('loadRecordLocalStorage calling');
      var records = JSON.parse(sessionStorage.getItem('records'));
      if (records == null) {
         return
      }
      fetchList = records
      // console.log(fetchList);
      generateTableRowsAsync(fetchList);
   }

   function fetchRecord(searchText) {
      // console.log('fetchRecord calling');

      $.ajax({
         url: "{%url 'bima_policy:fetch_record'%}",
         data: { data: searchText },
         dataType: 'json',
         success: function (response) {
            record = response.record
            // console.log(record);

            if (record === undefined) {
               showNotification('❌ No RECORD FOUND! ');
               return
            }

            generateSingleRowsAsync(record[0])

         },
         error: function (xhr, status, error) {
            console.error(error);
            alert(error.toString())
         }
      });

      showNotification('⌛️ Getting ready...')
   }

   function fetch_records(data) {
      // console.log('fetch_records calling');

      $.ajax({
         url: "{%url 'bima_policy:fetch_records'%}",
         data: { data: data },
         dataType: 'json',
         success: function (response) {
            // console.log(response.records);
            fetchList = response.records           
            generateTableRowsAsync(fetchList);
            sessionStorage.setItem('records', JSON.stringify(response.records));        
         },
         error: function (xhr, status, error) {
            console.error(error);
            alert(error.toString())
         }
      });
   }

   function fetch_filter_details(data) {
      // console.log('fetch_filter_details calling');

      $.ajax({
         url: "{%url 'bima_policy:fetch_records'%}",
         data: { data: data },
         dataType: 'json',
         success: function (response) {
            // console.log(response.agents);
            localStorage.setItem('agents', JSON.stringify(response.agents));
            localStorage.setItem('insurers', JSON.stringify(response.insurers));
            localStorage.setItem('vehicle_categories', JSON.stringify(response.vehicle_categories));
            localStorage.setItem('makes', JSON.stringify(response.makes));
            localStorage.setItem('models', JSON.stringify(response.models));
            // console.log(JSON.parse(localStorage.getItem('agents')));            

         },
         error: function (xhr, status, error) {
            console.error(error);
            alert(error.toString())
         }
      });
   }

   document.addEventListener('DOMContentLoaded', function () {

      loadRecordLocalStorage()
      fetch_records("")
      fetch_filter_details("mix")
   });


</script>


{%endblock%}